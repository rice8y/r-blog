---
title: TeX 入門
date: '2024-09-04'
tags: ['TeX']
summary: 
---

## TeX

### Hello, TeX!

まずは, Hello, world! ならぬ Hello, TeX! をする. TeX における標準入出力を行うためのマクロを以下のように定義する.

```tex:stdio.tex
\def \ReadStdin(#1){
  {
    \endlinechar = -1
    \global\read 0 to #1
  }
}

\def \WriteStdout(#1){
  \immediate\write 0 {#1}
}
```

以降では, 上記のファイルを読み込んで `\ReadStdin`, `\WriteStdout` を使用する.

Hello, TeX! をするには以下のように記述する.

```tex:hello.tex
\input{stdio}

\ReadStdin(\Name)
\WriteStdout(Hello, \Name!)
\end
```

続いて, 以下のように実行する[^1]. なお, 本記事では LuaTeX を使用する.  

```txt
$ luatex --halt-on-error hello.tex 
This is LuaTeX, Version 1.15.0 (TeX Live 2022) 
 restricted system commands enabled.
(./hello.tex (./stdio.tex)
\Name =TeX
Hello, TeX!
)
warning  (pdf backend): no pages of output.
Transcript written on hello.log.

```

上記の実行結果より, 標準入力として `\Name =` が求められ, `TeX` と入力すると, 標準出力で `Hello, TeX!` が出力されていることが分かる.

<details>
<summary>単なる Hello, world! の場合</summary>

```tex:hello.tex
\input{stdio}
\WriteStdout(Hello, world!)
\end
```

**実行結果**
```txt
$ luatex --halt-on-error hello.tex
This is LuaTeX, Version 1.15.0 (TeX Live 2022) 
 restricted system commands enabled.
(./hello.tex (./stdio.tex)
Hello, world!
)
warning  (pdf backend): no pages of output.
Transcript written on hello.log.

```
</details>

### プロセッサ構成

TeX の処理系は以下の4つのプロセッサから構成されている.

- 入力プロセッサ
 - ソースコードの文字列からトークン列を作る.
- 展開プロセッサ
 - トークン列を必要に応じて展開し, 展開後のトークン列にする.
- 実行プロセッサ
 - 展開後のトークン列を実行し, 処理系の内部状態を変更したり組版のボックスリストを作る.
- 出力プロセッサ
 - 組版のボックスリストからページを出力する.

### トークンの種類

- 文字トークン
 - `a`, `1`, `@` 等.
- 制御トークン
 - `\` から始まる文字列 (`\let`, `\relax` 等).

なお, 制御トークンは, 展開されるトークンと展開されないトークン, `\let` で代入されたトークンに大別される. 

**展開されるトークン**

|トークンの種類|例|
|---|---|
|マクロ|`\def` 等で定義されたトークン|
|条件分岐|`\if`, `\ifnum`, `\fi` 等|
|展開制御|`\expandafter`, `\noexpand` 等|
|組込みの変換|`\number`, `\string` 等|

**展開されないトークン**

|トークンの種類|例|
|---|---|
|整数変数|`\newcount` 等で定義されたトークン|
|整数演算|`\advance`, `\multiply` 等|
|定義|`\def`, `\let` 等|
|何もしない命令|`\relax`|
|組版用の命令||

### 整数変数

整数変数は `\newcount` で定義する[^2].

```tex:ex01.tex
\input{stdio}

\newcount \Mynum
\Mynum = 10
\WriteStdout(\Mynum)
\WriteStdout(\number \Mynum)
\end
```

実行結果は以下のようになる.

```txt
$ luatex --halt-on-error ex01.tex
This is LuaTeX, Version 1.15.0 (TeX Live 2022) 
 restricted system commands enabled.
(./ex01.tex (./stdio.tex)
\Mynum
10
)
warning  (pdf backend): no pages of output.
Transcript written on ex01.log.

```

上記の実行結果より, `\Mynum` は展開されないが, `\Count \Mynum` は展開されていることが分かる.

### 整数リテラル

整数リテラルは, デフォルトで10進数, `'` で8進数, `"` で16進数となる.

```tex:ex02.tex
\input{stdio}

\newcount \Mydec
\newcount \Myoct
\newcount \Myhex

\Mydec = 10
\Myoct = '12
\Myhex = "A

\WriteStdout(\Mydec is \number \Mydec.)
\WriteStdout(\Myoct is \number \Myoct.)
\WriteStdout(\Myhex is \number \Myhex.)
\end
```

実行結果は以下のようになる.

```txt
$ luatex --halt-on-error ex02.tex
This is LuaTeX, Version 1.15.0 (TeX Live 2022) 
 restricted system commands enabled.
(./ex02.tex (./stdio.tex)
\Mydec is 10.
\Myoct is 10.
\Myhex is 10.
)
warning  (pdf backend): no pages of output.
Transcript written on ex02.log.

```

また, 整数リテラルの前後に展開されるトークンを以下のように置くと, 整数リテラルと展開されるトークンが (展開されて) 繋がってしまう.

```tex:ex03.tex
\input{stdio}

\newcount \MynumOne
\newcount \MynumTwo
\def \One{1}

\MynumOne = 12\One
\MynumTwo = \One12

\WriteStdout(\MynumOne is \number \MynumOne.)
\WriteStdout(\MynumTwo is \number \MynumTwo.)
\end
```

実行結果は以下のようになる.

```txt
$ luatex --halt-on-error ex03.tex
This is LuaTeX, Version 1.15.0 (TeX Live 2022) 
 restricted system commands enabled.
(./ex03.tex (./stdio.tex)
\MynumOne is 121.
\MynumTwo is 112.
)
warning  (pdf backend): no pages of output.
Transcript written on ex03.log.

```

上記の実行結果より, まず, `\One` が展開され[^3], その後, 整数リテラルと繋がっていることが分かる.

これを防ぐには, 空白の文字トークンや `\relax` を入れる.

```tex:ex04.tex
\input{stdio}

\newcount \MynumOne
\newcount \MynumTwo
\def \One{1}

\MynumOne = 12 \One
\MynumTwo = 12\relax\One

\WriteStdout(\MynumOne is \number \MynumOne.)
\WriteStdout(\MynumTwo is \number \MynumTwo.)
\end
```

実行結果は以下のようになる.

```txt
$ luatex --halt-on-error ex04.tex
This is LuaTeX, Version 1.15.0 (TeX Live 2022) 
 restricted system commands enabled.
(./ex04.tex (./stdio.tex)
\MynumOne is 12.
\MynumTwo is 12.
[1{c:/texlive/2022/texmf-var/fonts/map/pdftex/updmap/pdftex.map}])<c:/texlive/2
022/texmf-dist/fonts/type1/public/amsfonts/cm/cmr10.pfb>
Output written on ex04.pdf (1 page, 8173 bytes).
Transcript written on ex04.log.

```

なお, `\Mynum = \One\relax12` とすると, `\Mynum` には `1` が代入される. これは, 制御トークンの後ろの空白は全て無視されるためである.

[^1]: `--halt-on-error` オプションは, エラー発生時に処理系の実行を終了させるために指定している.
[^2]: TeX で `1+2` とすると `1`, `+`, `2` というトークン列に分解される.
[^3]: 整数リテラルとして扱えるトークンがある可能性があるため.