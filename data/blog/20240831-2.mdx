---
title: Typst 入門
date: '2024-08-31'
tags: ['Typst', 'Rust', 'LaTeX']
summary: 新興組版システムである Typst に入門してみた話.
---

> [!NOTE]
> 本記事では, Rust がインストールされていることを前提とします. `cargo` 以外のインストール方法については [GitHub](https://github.com/typst/typst?tab=readme-ov-file#installation) を参照してください.

## Typst

## 環境構築

まず, 以下のコマンドで Typst をインストールする. 

```shell
cargo install --git https://github.com/typst/typst --locked typst-cli
```

<details>
<summary>インストールに少し困った話</summary>
上記のコマンドでインストールしたところ, `openssl-sys` クレートが必要な OpenSSL ライブラリが見つからないと怒られてしまった...

**解決方法**: 

まず, OpenSSL をインストールする.

```shell
sudo apt-get update
sudo apt-get install libssl-dev
```

次に, ライブラリの場所を探す. 

```shell
find /usr -name 'libssl*'
```

`export` で `OPENSSL_LIB_DIR` と `OPENSSL_INCLUDE_DIR` を環境変数として追加する.

再度, インストールする. 

```shell
cargo install --git https://github.com/typst/typst --locked typst-cli
```

無事にインストールできた!!
</details>

インストールが完了したら, インストールされているか確認する.

```shell
$ typst --version
typst 0.11.0 (e6cdcc53)
```

## 使用方法

まずは, Hello, World! してみる.

```typst:hello.typ
Hello, World!
```

`.typ` ファイルを作成し, 以下のコマンドでコンパイルする.

```shell
typst compile hello.typ
```

上記により, 以下が得られる.

![hello](/static/images/typst/hello.png)

Hello, World! は英語なので言語設定は不要であるが, 日本語を扱う際には以下のようにする. 

```typst: ja.typ
#set text(lang: "ja", font: "IPAexMincho")

ねこはひらがなです。猫は漢字です。
```

出力は以下のようになる.

![ja](/static/images/typst/ja.png)

なお, Typst で使用できるフォントは `typst fonts` で確認できる. 

<details>
<summary>フォントのインストール例</summary>
`typst fonts` で使用したいフォントが見つからない場合は, 以下のようにしてフォントをシステムにインストールする.

```shell
wget https://moji.or.jp/wp-content/ipafont/IPAexfont/IPAexfont00401.zip
unzip IPAexfont00401.zip
mkdir -p ~/.fonts
cp IPAexfont00401/*.ttf ~/.fonts/
fc-cache -f -v
```

インストールが成功したかは以下で確認する.

```shell
fc-list | grep "IPAexMincho"
```
</details>

### 文字修飾

Typst では, 構文と関数で文字修飾が行える. 

|修飾内容|構文|関数|
|----|----|----|
|段落区切り|空白1行|`#parbreak()`|
|改行|`\`|`#linebreak()`|
|太字強調|`*text*`|`#strong[]`|
|斜体強調|`_text_`|`#emph[]`|
|生文字列|`` `text` ``|`#raw()`|
|ハイパーリンク|`https://`, `http://`|`#link()`|
|ラベル|`<text>`|`#label()`|
|ヘッダ|`=`|`#heading()`|
|引用|`@text`||
|箇条書きリスト|`-`|`#list()`|
|番号リスト|`+`, `1.`|`#enum()`|
|用語リスト|`/ 用語: 説明`||
|数式|`$ 1 + 2 = 3 $`||
|特殊引用符|`'text'`, `"text"`||
|特殊文字|`$ mu $`|`#sym.mu`|
|エスケープシーケンス|`\`||
|コメント|`/* comment */`, `// comment`||

実際の出力を見てみる.

```typst:ex01.typ
#set text(lang: "ja", font: "Harano Aji Mincho")

= 見出し1

これは*構文による太字*, これは#strong[関数による太字]. \
これは `\` による改行. #linebreak()
これは `#linebreak()` による改行.

これは空行による段落区切り. #parbreak()
これは `#parbreak()` による段落区切り.

以下は `-` による箇条書きリスト.
- リスト1
- リスト2
- リスト3

以下は `#list()` による箇条書きリスト.
#list(
  [リスト1],
  [リスト2],
  [リスト3]
)

以下は番号付きリスト.
+ これは `+`
2. これは `2.`

== 見出し2

以下は `https://` によるハイパーリンク. \
https://github.com/typst/typst

以下は `#link()` によるハイパーリンク. \
#link("https://github.com/typst/typst")

/ 用語リスト: 用語リストは `/ 用語: 説明` とする.

数式は以下のようにする.
$ (partial u) / (partial t) + u (partial u) / (partial x) = nu (partial^(2) u) / (partial x^(2)) $

'特殊引用符1', "特殊引用符2".

#figure(
  table(
    columns: 2,
    [a], [b],
    [c], [d]
  ), 
  caption: [表の例]
)<tb1>

@tb1 は表の例.

// これはコメント.
/*
複数行のコメントは
/**/ の方が良いかも.
*/
```

**出力**:  
![ex01](/static/images/typst/ex01.png)

### 表

表は `#table()` を使用して作成する.

```typst:ex02.typ
#set text(lang:"ja", font: "IPAexMincho")

#table(
  columns: 2,
  [*関数*], [*説明*],
  [`#table()`], [表],
  [`#figure()`], [図]
)
```

**出力**:  
![ex02](/static/images/typst/ex02.png)

キャプションを付けるには `#figure()` を使用する. また, ラベル付けは `<>` で行い, `@` で参照する.

```typst:ex03.typ
#set text(lang:"ja", font: "IPAexMincho")

@tb01 にキャプション付きの表の例を示す.

#figure(
  table(
    columns: 2,
    [*関数*], [*説明*],
    [`#table()`], [表],
    [`#figure()`], [図]
  ),
  caption: [キャプション]
)<tb01>
```

**出力**:  
![ex03](/static/images/typst/ex03.png)

表の細かな設定は `#show` で行える. 

```typst:ex04.typ
#set text(font: "New Computer Modern")

#show table.cell.where(x: 1): set text(weight: "bold")
#show table.cell.where(y: 0): strong

#let frame(stroke) = (x, y) => (
  left: if x > 0 { 0pt } else { stroke },
  right: stroke,
  top: if y < 2 { stroke } else { 0pt },
  bottom: stroke,
)

#set table(
  fill: (rgb("EAF2F5"), none),
  stroke: frame(rgb("21222C")),
)

#table(
  columns: (0.4fr, 1fr, 1fr, 1fr),
  table.header[0.4fr][1fr][1fr][1fr],
  [default], [bold], [default], [default],
  [default], [bold], [default], [default]
)
```

**出力**:  
![ex04](/static/images/typst/ex04.png)

上記では, ヘッダ (`table.cell.where(y: 0)`) を `strong` で太字にし, 左から2列目 (`table.cell.where(x: 1)`) のセル内の文字列を `set text(weight: "bold")` で太字にしている. 
また, 条件分岐により 外枠のみ枠線を表示し, `fill`で特定列のセルの色を変更している. 